{"ast":null,"code":"import _regeneratorRuntime from\"/home/web29/web_project/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/home/web29/web_project/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/home/web29/web_project/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/web29/web_project/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/home/web29/web_project/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";var _templateObject;import React,{useState,useRef,useEffect}from\"react\";import styled from\"styled-components\";import moment from\"moment\";import Cookies from\"js-cookie\";import axios from\"axios\";import{useNavigate,useLocation}from\"react-router-dom\";import{Empty}from\"antd\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var PostPanel=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  width: 100%;\\n  height: 100%;\\n  display: flex;\\n  flex-direction: column;\\n  font-size: 20px;\\n  text-align: center;\\n  align-items: center;\\n\\n  .content {\\n    height: 500px;\\n    width: 1000px;\\n  }\\n  div {\\n    margin: 10px;\\n  }\\n  .exist {\\n    border: none;\\n    background-color: 0;\\n    margin: 5px;\\n  }\\n\"])));function EditPost(){var location=useLocation();var id=location.state.id;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),imageFilenames=_useState2[0],setImage=_useState2[1];var navigate=useNavigate();var images=[];var num=location.state.number;var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),fileLength=_useState4[0],setLength=_useState4[1];var _useState5=useState({number:\"\",id:\"\",date:\"\",contents:\"\"}),_useState6=_slicedToArray(_useState5,2),inputPost=_useState6[0],setPost=_useState6[1];useEffect(function(){_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var temp,i;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:temp=location.state.images;for(i in temp[0]){if(temp[0][i]!==null){if(i!==\"number\")images.push(temp[0][i]);}setImage(images);}setPost(_objectSpread(_objectSpread({},inputPost),{},{number:location.state.number,id:location.state.id,contents:location.state.contents}));case 3:case\"end\":return _context.stop();}}},_callee);}))();},[]);var formData=new FormData();var existFileClick=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){var idx,filtered;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:idx=e.target.id;document.getElementById(idx).style.display=\"none\";delete imageFilenames[idx];filtered=imageFilenames.filter(function(el){return el!=null;});setImage(filtered);setLength(filtered.length);case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function existFileClick(_x){return _ref2.apply(this,arguments);};}();var handleChangeFile=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(e){var i;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(e.target.files.length>5-imageFilenames.length){alert(\"파일 최대 5개만 선택가능 다시 선택하세요.\");}else{for(i=0;i<5;i++){formData.append(\"img\",e.target.files[i]);}}case 1:case\"end\":return _context3.stop();}}},_callee3);}));return function handleChangeFile(_x2){return _ref3.apply(this,arguments);};}();var handleChangePost=function handleChangePost(e){var date=moment().format(\"YYYY-MM-DD HH:mm\");setPost(_objectSpread(_objectSpread({},inputPost),{},{contents:e.target.value,id:id,date:date}));};var subimtOnClick=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(e){var config,result2;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:config={header:{\"content-type\":\"multipart/form-data\"}};_context4.prev=1;_context4.next=4;return axios.post(\"/write/updatePost\",inputPost);case 4:result2=_context4.sent;formData.append(\"f1\",imageFilenames[0]);formData.append(\"f2\",imageFilenames[1]);formData.append(\"f3\",imageFilenames[2]);formData.append(\"f4\",imageFilenames[3]);formData.append(\"f5\",imageFilenames[4]);formData.append(\"num\",num);formData.append(\"fileLength\",imageFilenames.length);// let result = await axios.post(\"/write/updateImages\", formData, config);\n// console.log(result.data);\n_context4.next=17;break;case 14:_context4.prev=14;_context4.t0=_context4[\"catch\"](1);// alert(\"지원하지않는 파일존재\\n 다른 이미지 파일을 넣어주세요.\");\nalert(_context4.t0);case 17:navigate(\"/home\");case 18:case\"end\":return _context4.stop();}}},_callee4,null,[[1,14]]);}));return function subimtOnClick(_x3){return _ref4.apply(this,arguments);};}();var deleteOnClick=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var result;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;_context5.next=3;return axios.post(\"/write/deletePost\",inputPost);case 3:result=_context5.sent;navigate(\"/home\");_context5.next=9;break;case 7:_context5.prev=7;_context5.t0=_context5[\"catch\"](0);case 9:case\"end\":return _context5.stop();}}},_callee5,null,[[0,7]]);}));return function deleteOnClick(){return _ref5.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(PostPanel,{children:[/*#__PURE__*/_jsx(\"input\",{className:\"content\",placeholder:\"\\uB0B4\\uC6A9\\uC785\\uB825\",type:\"email\",value:inputPost.contents,onChange:handleChangePost}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",className:\"file\",id:\"file\",name:\"img\",onChange:handleChangeFile,multiple:\"multiple\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{children:\"\\uC874\\uC7AC\\uD558\\uB294 \\uD30C\\uC77C\\uC774\\uB984 \\uD074\\uB9AD \\uC2DC \\uC0AD\\uC81C\\uB428\"}),\"\\uD604\\uC7AC \\uC874\\uC7AC\\uD558\\uB294\\uD30C\\uC77C\",imageFilenames.map(function(fname,idx){return/*#__PURE__*/_jsx(\"button\",{className:\"exist\",id:idx,onClick:existFileClick,children:fname},fname);})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",onClick:subimtOnClick,children:\"\\uC218\\uC815\"}),/*#__PURE__*/_jsx(\"button\",{onClick:deleteOnClick,children:\"\\uAC8C\\uC2DC\\uBB3C \\uC0AD\\uC81C\"})]});}export default EditPost;","map":{"version":3,"sources":["/home/web29/web_project/client/src/components/post/EditPost.js"],"names":["React","useState","useRef","useEffect","styled","moment","Cookies","axios","useNavigate","useLocation","Empty","PostPanel","div","EditPost","location","id","state","imageFilenames","setImage","navigate","images","num","number","fileLength","setLength","date","contents","inputPost","setPost","temp","i","push","formData","FormData","existFileClick","e","idx","target","document","getElementById","style","display","filtered","filter","el","length","handleChangeFile","files","alert","append","handleChangePost","format","value","subimtOnClick","config","header","post","result2","deleteOnClick","result","map","fname"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect } from \"react\";\nimport styled from \"styled-components\";\nimport moment from \"moment\";\nimport Cookies from \"js-cookie\";\nimport axios from \"axios\";\nimport { useNavigate, useLocation } from \"react-router-dom\";\nimport { Empty } from \"antd\";\n\nconst PostPanel = styled.div`\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  font-size: 20px;\n  text-align: center;\n  align-items: center;\n\n  .content {\n    height: 500px;\n    width: 1000px;\n  }\n  div {\n    margin: 10px;\n  }\n  .exist {\n    border: none;\n    background-color: 0;\n    margin: 5px;\n  }\n`;\n\nfunction EditPost() {\n  const location = useLocation();\n  const id = location.state.id;\n  const [imageFilenames, setImage] = useState([]);\n  const navigate = useNavigate();\n  const images = [];\n  const num = location.state.number;\n  const [fileLength, setLength] = useState(0);\n  const [inputPost, setPost] = useState({\n    number: \"\",\n    id: \"\",\n    date: \"\",\n    contents: \"\",\n  });\n\n  useEffect(() => {\n    (async () => {\n      const temp = location.state.images;\n      for (let i in temp[0]) {\n        if (temp[0][i] !== null) {\n          if (i !== \"number\") images.push(temp[0][i]);\n        }\n        setImage(images);\n      }\n\n      setPost({\n        ...inputPost,\n        number: location.state.number,\n        id: location.state.id,\n        contents: location.state.contents,\n      });\n    })();\n  }, []);\n\n  const formData = new FormData();\n\n  const existFileClick = async (e) => {\n    let idx = e.target.id;\n    document.getElementById(idx).style.display = \"none\";\n    delete imageFilenames[idx];\n    let filtered = imageFilenames.filter(function (el) {\n      return el != null;\n    });\n    setImage(filtered);\n    setLength(filtered.length);\n  };\n  const handleChangeFile = async (e) => {\n    if (e.target.files.length > 5 - imageFilenames.length) {\n      alert(\"파일 최대 5개만 선택가능 다시 선택하세요.\");\n    } else {\n      for (let i = 0; i < 5; i++) {\n        formData.append(\"img\", e.target.files[i]);\n      }\n    }\n  };\n\n  const handleChangePost = (e) => {\n    let date = moment().format(\"YYYY-MM-DD HH:mm\");\n    setPost({\n      ...inputPost,\n      contents: e.target.value,\n      id: id,\n      date: date,\n    });\n  };\n\n  const subimtOnClick = async (e) => {\n    const config = {\n      header: { \"content-type\": \"multipart/form-data\" },\n    };\n    try {\n      let result2 = await axios.post(\"/write/updatePost\", inputPost);\n      formData.append(\"f1\", imageFilenames[0]);\n      formData.append(\"f2\", imageFilenames[1]);\n      formData.append(\"f3\", imageFilenames[2]);\n      formData.append(\"f4\", imageFilenames[3]);\n      formData.append(\"f5\", imageFilenames[4]);\n      formData.append(\"num\", num);\n      formData.append(\"fileLength\", imageFilenames.length);\n      // let result = await axios.post(\"/write/updateImages\", formData, config);\n      // console.log(result.data);\n    } catch (err) {\n      // alert(\"지원하지않는 파일존재\\n 다른 이미지 파일을 넣어주세요.\");\n      alert(err);\n    }\n    navigate(\"/home\");\n  };\n\n  const deleteOnClick = async () => {\n    try {\n      let result = await axios.post(\"/write/deletePost\", inputPost);\n      navigate(\"/home\");\n    } catch {}\n  };\n\n  return (\n    <PostPanel>\n      <input\n        className=\"content\"\n        placeholder=\"내용입력\"\n        type=\"email\"\n        value={inputPost.contents}\n        onChange={handleChangePost}\n      />\n      <input\n        type=\"file\"\n        className=\"file\"\n        id=\"file\"\n        name=\"img\"\n        onChange={handleChangeFile}\n        multiple=\"multiple\"\n      />\n      <div>\n        <div>존재하는 파일이름 클릭 시 삭제됨</div>\n        현재 존재하는파일\n        {imageFilenames.map((fname, idx) => (\n          <button\n            className=\"exist\"\n            key={fname}\n            id={idx}\n            onClick={existFileClick}\n          >\n            {fname}\n          </button>\n        ))}\n      </div>\n\n      <button type=\"submit\" onClick={subimtOnClick}>\n        수정\n      </button>\n      <button onClick={deleteOnClick}>게시물 삭제</button>\n    </PostPanel>\n  );\n}\n\nexport default EditPost;\n"]},"metadata":{},"sourceType":"module"}